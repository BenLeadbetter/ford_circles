<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Circular Inversion</title>
        <link href="main.css" rel="stylesheet" />
        <script>
            let scale = 1.0;

            document.addEventListener("DOMContentLoaded",() => { onLoad(); })

            function createCircle(x, y, radius) {
                let circle = document.createElementNS('http://www.w3.org/2000/svg', "circle");
                circle.setAttribute("cx", x);
                circle.setAttribute("cy", y);
                circle.setAttribute("r", radius);
                document.getElementById("scene").appendChild(circle);
            }

            function hcf(a, b) {
                while (b != 0) {
                    let temp = a;
                    a = b;
                    b = temp % b;
                }
                return a;
            }

            function onLoad() {
                drawCircles();
                document.getElementById("scene").addEventListener("wheel", zoomImage);
            }

            function drawCircles() {
                const scaleFactor = 80;
                for (let q = 1; q < 20; ++q) {
                    for (let p = 0; p < q * 3; ++p) {
                        if (hcf(q, p) != 1) {
                            continue;
                        }

                        r = 1 / (2 * q * q);
                        createCircle(
                            (p / q) * scaleFactor, 
                            r * scaleFactor, 
                            r * scaleFactor);
                    }
                }
            }

            function zoomImage(event) {
                event.preventDefault();
                const oldScale = scale;
                scale += event.deltaY * - 0.01;
                scale = Math.max(Math.min(scale, 6), 1); // clamp
                const scene = document.getElementById("scene");

                const sceneRectangle = scene.getBoundingClientRect();
                const x = event.x - sceneRectangle.left;
                const y = event.y - sceneRectangle.top;

                scene.style.transformOrigin = `0 0`;

                scene.style.transform = `scale(${scale})`;
            }
        </script>
    </head>
    <body>
        <h1>Circular Inversion</h1>
        <svg 
            id="scene" 
            viewBox="0 0 200 200" 
            stroke="black" 
            fill="transparent" 
        />
    </body>
</html>